# MyResty API Server Configuration
# 核心配置 - 路由由 app/routes.lua 定义

server {
	listen 8080;
	server_name localhost;

    lua_need_request_body on;

	root $root;
	index index.lua;

	access_log $root/logs/access.log myresty_log;
	error_log $root/logs/error.log warn;

	location / {
		rewrite_by_lua_file $root/middleware/rewrite.lua;
		access_by_lua_file $root/middleware/access.lua;
		content_by_lua_file $root/bootstrap.lua;
		header_filter_by_lua_file $root/middleware/header_filter.lua;
		body_filter_by_lua_file $root/middleware/body_filter.lua;
		log_by_lua_file $root/middleware/log.lua;
	}

	location /static {
		alias $root/static;
		expires 7d;
		add_header Cache-Control "public, immutable";
	}

	location /health {
		content_by_lua 'ngx.say("OK")';
	}

	location ~ \.lua$ {
		deny all;
	}
}
