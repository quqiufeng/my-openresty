# MyResty API Server Configuration
# 核心配置 - 路由由 app/routes.lua 定义

server {
	listen 8080;
	server_name localhost;

    lua_need_request_body on;

	root /var/www/web/my-resty;
	index index.lua;

	access_log /var/www/web/my-resty/logs/access.log myresty_log;
	error_log /var/www/web/my-resty/logs/error.log warn;

	location / {
		rewrite_by_lua_file /var/www/web/my-resty/middleware/rewrite.lua;
		access_by_lua_file /var/www/web/my-resty/middleware/access.lua;
		content_by_lua_file /var/www/web/my-resty/bootstrap.lua;
		header_filter_by_lua_file /var/www/web/my-resty/middleware/header_filter.lua;
		body_filter_by_lua_file /var/www/web/my-resty/middleware/body_filter.lua;
		log_by_lua_file /var/www/web/my-resty/middleware/log.lua;
	}

	location /static {
		alias /var/www/web/my-resty/static;
		expires 7d;
		add_header Cache-Control "public, immutable";
	}

	location /health {
		content_by_lua 'ngx.say("OK")';
	}

	location ~ \.lua$ {
		deny all;
	}
}
