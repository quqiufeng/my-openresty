# MyResty API Server Configuration
# 核心配置 - 路由由 app/routes.lua 定义

server {
	listen 8080;
	server_name localhost;

    lua_need_request_body on;

	root /var/www/web/my-openresty;
	index index.lua;

	access_log /var/www/web/my-openresty/logs/access.log;
	error_log /var/www/web/my-openresty/logs/error.log warn;

	location / {
		rewrite_by_lua_file /var/www/web/my-openresty/middleware/rewrite.lua;
		access_by_lua_file /var/www/web/my-openresty/middleware/access.lua;
		content_by_lua_file /var/www/web/my-openresty/bootstrap.lua;
		header_filter_by_lua_file /var/www/web/my-openresty/middleware/header_filter.lua;
		body_filter_by_lua_file /var/www/web/my-openresty/middleware/body_filter.lua;
		log_by_lua_file /var/www/web/my-openresty/middleware/log.lua;
	}

	location /static {
		alias /var/www/web/my-openresty/static;
		expires 7d;
		add_header Cache-Control "public, immutable";
	}

	location /health {
		content_by_lua "ngx.say(\"OK\")";
	}

	location ~ \.lua$ {
		deny all;
	}
}
